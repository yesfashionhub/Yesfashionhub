
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Yes Fashion Hub</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{font-family:'Inter',sans-serif;margin:0;background:#f5f5f5;color:#222;}
    header{background:#25D366;color:#fff;padding:12px 18px;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;}
    .cart-btn{background:#128C7E;border:none;border-radius:50%;width:46px;height:46px;font-size:22px;color:#fff;cursor:pointer;position:relative;}
    .cart-count{position:absolute;top:-6px;right:-6px;background:#ff3b30;color:#fff;border-radius:50%;font-size:12px;padding:3px 7px;}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:14px;padding:14px;}
    .card{background:#fff;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1);overflow:hidden;transition:transform 0.2s;}
    .card:hover{transform:scale(1.02);}
    .card img{width:100%;height:170px;object-fit:cover;}
    .card h3{margin:8px;font-size:15px;}
    .card p{margin:4px 8px;font-size:13px;color:#555;}
    .btn{background:#25D366;color:#fff;border:none;border-radius:6px;padding:8px 12px;margin:8px;font-weight:600;cursor:pointer;}
    .btn:hover{background:#1eb85c;}
    .modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:1000;}
    .modal-box{background:#fff;padding:20px;border-radius:10px;width:90%;max-width:500px;max-height:90vh;overflow:auto;}
    .thumbs{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;}
    .thumbs img{width:70px;height:70px;object-fit:cover;border-radius:6px;cursor:pointer;border:2px solid transparent;}
    .thumbs img:hover{border-color:#25D366;}
    .loader{width:50px;height:50px;border:5px solid #ccc;border-top-color:#25D366;border-radius:50%;animation:spin 1s linear infinite;margin:auto;}
    @keyframes spin{to{transform:rotate(360deg);}}
  </style>
</head>
<body>

<header>
  <h2>ðŸ‘— Yes Fashion Hub</h2>
  <button id="cartBtn" class="cart-btn">ðŸ›’<span id="cartCount" class="cart-count">0</span></button>
</header>

<div style="padding:10px;">
  <input id="searchBox" placeholder="Search products..." style="padding:10px;width:100%;border-radius:8px;border:1px solid #ccc;">
  <select id="categoryFilter" style="margin-top:8px;padding:10px;width:100%;border-radius:8px;border:1px solid #ccc;">
    <option value="All">All Categories</option>
  </select>
</div>

<div id="productGrid" class="grid"></div>
<div id="modalRoot"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const SHEET_URL = "https://script.google.com/macros/s/AKfycbygSw84ilE06oLMHZRsVD4jxEMvFECccQKl6A80UbkjtNpO_sAwbC_aS1hSjhIghPre/exec";  // ðŸ”¹ replace with your deployed Apps Script exec URL
const DRIVE_UPLOAD_URL = "https://script.google.com/macros/s/AKfycbygSw84ilE06oLMHZRsVD4jxEMvFECccQKl6A80UbkjtNpO_sAwbC_aS1hSjhIghPre/exec";
const WHATSAPP_NO = "919978653852"; // your WhatsApp number (no +)

let products = [];
let cart = JSON.parse(localStorage.getItem('yf_cart')||'[]');
updateCartBadge();

// ==== FETCH SHEET (JSONP) ====
async function fetchSheet(){
  return new Promise((resolve,reject)=>{
    const cb='cb_'+Date.now();
    window[cb]=(d)=>{
      products = d.data || [];
      const cats=[...new Set(products.map(p=>p.Categories))].filter(Boolean);
      $('categoryFilter').innerHTML='<option value="All">All</option>'+cats.map(c=>`<option>${c}</option>`).join('');
      renderProducts();
      delete window[cb]; resolve();
    };
    const s=document.createElement('script');
    s.src=`${SHEET_URL}?callback=${cb}`;
    s.onerror=()=>reject(new Error("Network error"));
    document.body.appendChild(s);
  });
}
fetchSheet();

// ==== RENDER PRODUCTS ====
function renderProducts(){
  const q=$('searchBox').value.toLowerCase();
  const cat=$('categoryFilter').value;
  const grid=$('productGrid'); grid.innerHTML='';
  const filtered=products.filter(p=>{
    const mq=!q||(p.Pname||'').toLowerCase().includes(q);
    const mc=(cat==='All')||p.Categories===cat;
    return mq&&mc;
  });
  filtered.forEach(p=>{
    const imgs=(p.Pimage||'').split(/[,]+/).filter(Boolean);
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`
      <img src="${imgs[0]||''}" alt="${p.Pname}">
      <h3>${p.Pname}</h3>
      <p>${p.Pdesc||''}</p>
      <button class='btn' onclick='viewCollection(${JSON.stringify(p).replace(/"/g,"&quot;")})'>View Full Collection</button>`;
    grid.appendChild(div);
  });
}
$('searchBox').oninput=renderProducts;
$('categoryFilter').onchange=renderProducts;

// ==== VIEW FULL COLLECTION ====
function viewCollection(p){
  const imgs=(p.Pimage||'').split(/[,]+/).filter(Boolean);
  const sizes=(p.Psize||'').split(/[,]+/).filter(Boolean);
  const modal=document.createElement('div');
  modal.className='modal';
  modal.innerHTML=`
    <div class='modal-box'>
      <img id='mainImg' src='${imgs[0]||''}' style='width:100%;height:300px;object-fit:cover;border-radius:8px;'>
      <div class='thumbs'>${imgs.map(u=>`<img src='${u}' onclick='document.getElementById("mainImg").src="${u}"'>`).join('')}</div>
      <h3>${p.Pname}</h3>
      <p>${p.Pdesc||''}</p>
      <p><b>â‚¹${p.Prate}</b> ${(p.Pgst||'').toLowerCase().includes('inc')?'(Incl. GST)':'(Excl. GST)'}</p>
      ${sizes.length?`<select id="sizeSel" style="width:100%;padding:8px;margin:8px 0;">${sizes.map(s=>`<option>${s}</option>`).join('')}</select>`:''}
      <button class='btn' onclick='addToCart({...${JSON.stringify(p)}, Psize: document.getElementById("sizeSel")?.value || ""})'>Add to Cart</button>
      <button class='btn' onclick='closeModal()'>Close</button>
    </div>`;
  $('modalRoot').innerHTML=''; $('modalRoot').appendChild(modal);
}

// ==== BASIC CART + HELPERS ====
function addToCart(p){
  const key=p.Pname+'|'+p.Psize;
  const ex=cart.find(c=>c.key===key);
  if(ex)ex.qty+=1;else cart.push({...p,qty:1,key});
  localStorage.setItem('yf_cart',JSON.stringify(cart));
  updateCartBadge(); toast('Added to cart');
}
function updateCartBadge(){ $('cartCount').innerText=cart.reduce((a,b)=>a+b.qty,0); }
function closeModal(){ $('modalRoot').innerHTML=''; }
function toast(msg){
  const t=document.createElement('div');
  t.textContent=msg;
  Object.assign(t.style,{position:'fixed',bottom:'20px',left:'50%',transform:'translateX(-50%)',background:'#25D366',color:'#fff',padding:'10px 16px',borderRadius:'8px',zIndex:9999});
  document.body.appendChild(t); setTimeout(()=>t.remove(),1200);
}
function $(id){return document.getElementById(id);}
</script>
</body>
</html>
